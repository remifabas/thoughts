<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js latte">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>thoughts</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="././mdbook-admonish.css">
        <link rel="stylesheet" href="./theme/catppuccin.css">
        <link rel="stylesheet" href="./theme/catppuccin-highlight.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "frappe" : "latte";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('latte')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><li class="part-title">First words</li><li class="chapter-item "><a href="introduction/introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="introduction/recreatebook.html"><strong aria-hidden="true">1.1.</strong> How to recreate this book</a></li></ol></li><li class="chapter-item "><li class="part-title">Dev</li><li class="chapter-item "><a href="dev/go.html"><strong aria-hidden="true">2.</strong> Go</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dev/go/pprof.html"><strong aria-hidden="true">2.1.</strong> PPROF</a></li></ol></li><li class="chapter-item "><a href="dev/rust.html"><strong aria-hidden="true">3.</strong> Rust</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="dev/rust/intro-borrow.html"><strong aria-hidden="true">3.1.</strong> Intro to ownership - borrow-checker</a></li><li class="chapter-item "><a href="dev/rust/borrow-checker.html"><strong aria-hidden="true">3.2.</strong> borrow-checker in maps</a></li><li class="chapter-item "><a href="dev/rust/async-intro.html"><strong aria-hidden="true">3.3.</strong> Async introduction</a></li></ol></li><li class="chapter-item "><li class="part-title">Ops</li><li class="chapter-item "><a href="ops/kubernetes.html"><strong aria-hidden="true">4.</strong> Kubernetes</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ops/kubernetes/architecture_overview.html"><strong aria-hidden="true">4.1.</strong> Architecture Overview</a></li><li class="chapter-item "><a href="ops/kubernetes/kind.html"><strong aria-hidden="true">4.2.</strong> Kind</a></li></ol></li><li class="chapter-item "><a href="ops/databases.html"><strong aria-hidden="true">5.</strong> Databases</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ops/sql.html"><strong aria-hidden="true">5.1.</strong> SQL</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ops/sql/postgres.html"><strong aria-hidden="true">5.1.1.</strong> Postgres</a></li></ol></li><li class="chapter-item "><a href="ops/nosql.html"><strong aria-hidden="true">5.2.</strong> NoSQL</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ops/nosql/dgraph.html"><strong aria-hidden="true">5.2.1.</strong> dgraph</a></li></ol></li></ol></li><li class="chapter-item "><a href="ops/testing.html"><strong aria-hidden="true">6.</strong> Testing</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="ops/testing/vegeta.html"><strong aria-hidden="true">6.1.</strong> Vegeta</a></li></ol></li><li class="chapter-item "><a href="ops/gpg-pgp.html"><strong aria-hidden="true">7.</strong> GPG-PGP & SOPS</a></li><li class="chapter-item "><a href="ops/linux.html"><strong aria-hidden="true">8.</strong> Linux</a></li><li class="chapter-item affix "><li class="part-title">General</li><li class="chapter-item "><a href="general/git.html"><strong aria-hidden="true">9.</strong> Git</a></li><li class="spacer"></li><li class="chapter-item affix "><a href="misc/contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="latte">Latte (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frapp√©</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">thoughts</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/remifabas/thoughts" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Why did this book exist ?</p>
<details id="admonition-tldr" class="admonition success">
<summary class="admonition-title">
<p>TL:DR</p>
<p><a class="admonition-anchor-link" href="introduction/introduction.html#admonition-tldr"></a></p>
</summary>
<div>
<p>Because i start a lof of projects, never finish them and forgot everything i did.</p>
</div>
</details>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-recreate-this-book"><a class="header" href="#how-to-recreate-this-book">How to recreate this book</a></h1>
<h2 id="install-rust"><a class="header" href="#install-rust">Install rust</a></h2>
<p><a href="https://www.rust-lang.org/tools/install">rust install documentation</a></p>
<h2 id="install-mdbook-with-cargo"><a class="header" href="#install-mdbook-with-cargo">Install mdbook with cargo</a></h2>
<p><a href="https://rust-lang.github.io/mdBook/guide/installation.html">mdbook install documentation</a></p>
<h2 id="activate-github-actions"><a class="header" href="#activate-github-actions">Activate Github actions</a></h2>
<p>In your github repository, go to settings, pages.
select : Deploy from branch, &lt;your_branch&gt;, and docs folder</p>
<h2 id="build-current-markdown-to-html"><a class="header" href="#build-current-markdown-to-html">Build current markdown to Html</a></h2>
<p>You can use some makefile targets to:</p>
<ul>
<li>locally serve the book</li>
</ul>
<pre><code>make serve
</code></pre>
<ul>
<li>build html/js in docs folder</li>
</ul>
<pre><code>make build
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="go-golang"><a class="header" href="#go-golang">Go, Golang</a></h1>
<details id="admonition-my-doc" class="admonition bug">
<summary class="admonition-title">
<p>My doc</p>
<p><a class="admonition-anchor-link" href="dev/go.html#admonition-my-doc"></a></p>
</summary>
<div>
<p>Be carefull, not always up to date.</p>
<ul>
<li><a href="dev/go/pprof.html">pprof</a></li>
</ul>
</div>
</details>
<div id="admonition-external-doc-and-links" class="admonition note">
<div class="admonition-title">
<p>External doc and links</p>
<p><a class="admonition-anchor-link" href="dev/go.html#admonition-external-doc-and-links"></a></p>
</div>
<div>
<ul>
<li><a href="https://go.dev/">Main website</a></li>
<li><a href="https://go.dev/doc/install">Install</a></li>
<li><a href="https://go.dev/solutions/use-cases">Uses cases</a></li>
<li><a href="https://github.com/avelino/awesome-go">Awesome-go</a></li>
<li><a href="https://github.com/golang-standards/project-layout">Base project layout</a></li>
</ul>
</div>
</div>
<ul>
<li>%s ‚Äì Print a string.</li>
<li>%d ‚Äì print an integer</li>
<li>%f ‚Äì floating point number.</li>
<li>%v ‚Äì print values of a struct.</li>
<li>%+v ‚Äì print struct fields and values.</li>
<li>%t ‚Äì print Boolean.</li>
<li>%b ‚Äì print binary value.</li>
<li>%e ‚Äì scientific notation</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pprof"><a class="header" href="#pprof">PPROF</a></h1>
<p><a href="https://github.com/google/pprof">pprof</a>
pprof is a tool for visualization and analysis of profiling data.</p>
<h2 id="analyse-web-server"><a class="header" href="#analyse-web-server">Analyse web server</a></h2>
<p>Add this to you program</p>
<pre><code class="language-go">package main

import _ &quot;net/http/pprof&quot;
import &quot;net/http&quot;

func main() {
    go func() {
        _ = http.ListenAndServe(&quot;localhost:6060&quot;, nil)
    }()
    // your code
}

</code></pre>
<p>Then you can make an http call to localhost:6060</p>
<h3 id="ram-profiling"><a class="header" href="#ram-profiling">RAM profiling</a></h3>
<p>A little info:
In order to analyze the currently used memory, just select the inuse indices (bytes or object counts):</p>
<ul>
<li>inuse_space: memory allocated but not yet released</li>
<li>inuse_objects: objects allocated but not yet released</li>
</ul>
<p>If you are interested in understanding the total amount of bytes or objects, use the alloc indices instead:</p>
<ul>
<li>alloc_space: ‚Ää the ‚Äätotal amount of memory allocated</li>
<li>alloc_objects‚Ää: the ‚Äätotal number of objects allocated</li>
</ul>
<p>flat: the memory allocated and held by this function
cum: the memory allocated by this function together with functions that it has called</p>
<p>Ok let's get some info !
Retrieve inuse_space: (by default --inuse_space you can forget it)</p>
<pre><code class="language-bash">go tool pprof --inuse_space -top http://localhost:6060/debug/pprof/heap
go tool pprof -png http://localhost:6060/debug/pprof/heap &gt; ram.png
</code></pre>
<p>Retrieve alloc_space</p>
<pre><code class="language-bash">go tool pprof --alloc_space -top http://localhost:6060/debug/pprof/heap
</code></pre>
<h3 id="cpu-profiling"><a class="header" href="#cpu-profiling">CPU profiling</a></h3>
<pre><code class="language-bash">go tool pprof -png &quot;http://localhost:6060/debug/pprof/profile?seconds=5&quot; &gt;cpu.png
</code></pre>
<h2 id="in-test"><a class="header" href="#in-test">In test</a></h2>
<p>https://wablesushmita.medium.com/cpu-memory-profiling-with-golang-pprof-3deddbd7b964</p>
<pre><code class="language-bash">go test -cpuprofile cpu.prof -memprofile mem.prof
go tool pprof cpu.prof
go tool pprof cpu.prof

go-torch generate svg
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust"><a class="header" href="#rust">Rust</a></h1>
<details id="admonition-my-doc" class="admonition bug">
<summary class="admonition-title">
<p>My doc</p>
<p><a class="admonition-anchor-link" href="dev/rust.html#admonition-my-doc"></a></p>
</summary>
<div>
<p>Be carefull, not always up to date.</p>
<ul>
<li><a href="dev/rust/intro-borrow.html">Intro to ownership - borrow-checker</a></li>
<li><a href="dev/rust/borrow-checker.html">borrow-checker</a></li>
<li><a href="dev/rust/async-intro.html">async introduction with tokio</a></li>
</ul>
</div>
</details>
<div id="admonition-external-doc-and-links" class="admonition note">
<div class="admonition-title">
<p>External doc and links</p>
<p><a class="admonition-anchor-link" href="dev/rust.html#admonition-external-doc-and-links"></a></p>
</div>
<div>
<ul>
<li><a href="https://www.rust-lang.org/">Main website</a></li>
<li><a href="https://www.rust-lang.org/tools/install">Install</a></li>
<li><a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021">Playground</a></li>
<li><a href="https://github.com/rust-unofficial/awesome-rust">Awesome-rust</a></li>
</ul>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="intro-to-ownership---borrow-checker"><a class="header" href="#intro-to-ownership---borrow-checker">Intro to ownership - borrow-checker</a></h1>
<h2 id="ownership"><a class="header" href="#ownership">Ownership</a></h2>
<p>It's really simple to try and create compiler error because of the ownership system in rust !</p>
<p>Let's says we have a simple hello world program:</p>
<pre><pre class="playground"><code class="language-rust">fn print_string(s: String) {
    println!(&quot;{}&quot;, s);
}

fn main() {
    let s = String::from(&quot;hello&quot;);
    print_string(s);
}</code></pre></pre>
<p>The code declare a string, a transmit this string to the function <code>print_string</code></p>
<p>Now let's says we want to call two times the  <code>print_string</code> function</p>
<div id="admonition-bug" class="admonition bug">
<div class="admonition-title">
<p>Bug</p>
<p><a class="admonition-anchor-link" href="dev/rust/intro-borrow.html#admonition-bug"></a></p>
</div>
<div>
<pre><pre class="playground"><code class="language-rust">fn print_string(s: String) {
    println!(&quot;{}&quot;, s);
}

fn main() {
    let s = String::from(&quot;hello&quot;);
    print_string(s);
    print_string(s);
}</code></pre></pre>
<p>This code does not compile. The compiler says two things:</p>
<ul>
<li>move occurs because <code>s</code> has type <code>String</code>, which does not implement the <code>Copy</code> trait</li>
<li>note: consider changing this parameter type in function <code>print_string</code> to borrow instead if owning the value isn't necessary</li>
</ul>
</div>
</div>
<p>Copy trait ? borrow instead if owning ? Ok let's take a step back.</p>
<p>In Rust, every value has a variable that's called its owner. There can only be one owner at a time, and when the owner goes out of scope, the value is dropped.</p>
<details id="admonition-the-value-is-dropped-" class="admonition info">
<summary class="admonition-title">
<p>the value is dropped ?</p>
<p><a class="admonition-anchor-link" href="dev/rust/intro-borrow.html#admonition-the-value-is-dropped-"></a></p>
</summary>
<div>
<p>When a value is &quot;dropped&quot;, it means that the memory allocated for that value is freed. Each value has a unique owner, and when the owner goes out of scope, the value is dropped and its memory is freed.</p>
<p>Dropping a value means that the destructor of that value is called. The destructor is responsible for cleaning up any resources that the value might be holding, such as closing file handles or freeing memory.</p>
</div>
</details>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let s = String::from(&quot;hello&quot;);
    println!(&quot;{}&quot;, s);
}</code></pre></pre>
<p>In this code, s is the owner of the string &quot;hello&quot;. When s goes out of scope at the end of the main function, the memory used to store the string is automatically returned to the system.</p>
<p>When you pass a value to a function, ownership of the value is transferred to the function. For example:</p>
<pre><pre class="playground"><code class="language-rust">fn print_string(s: String) {
    println!(&quot;{}&quot;, s);
}

fn main() {
    let s = String::from(&quot;hello&quot;);
    print_string(s);
}</code></pre></pre>
<p>In this code, ownership of the string &quot;hello&quot; is transferred to the print_string function when it's called. The function takes ownership of the string and then returns ownership to the system when it goes out of scope. So the memory of s is dropped at the end of <code>print_string</code> function.</p>
<div id="admonition-better-vision-to-this-drop-thing" class="admonition info">
<div class="admonition-title">
<p>Better vision to this drop thing</p>
<p><a class="admonition-anchor-link" href="dev/rust/intro-borrow.html#admonition-better-vision-to-this-drop-thing"></a></p>
</div>
<div>
<p>In Rust, we can implement the Drop trait to execute some code when a value is dropped. Here's an example:</p>
<pre><pre class="playground"><code class="language-rust">struct MyStruct {
    name: String,
}

impl MyStruct {
    fn new(name: &amp;str) -&gt; Self {
        MyStruct {
            name: String::from(name),
        }
    }
}


impl Drop for MyStruct {
    fn drop(&amp;mut self) {
        println!(&quot;MyStruct instance with name '{}' dropped&quot;, self.name);
    }
}

fn main() {
    let _s = MyStruct::new(&quot;example&quot;);
    // `_s` will be dropped at the end of this scope
    println!(&quot;End of main function&quot;);
}</code></pre></pre>
<p>You should see in output </p>
<p>End of main function<br />
MyStruct instance with name 'example' dropped</p>
<p>Now let's tweak the main function and give the ownership of <code>_s</code> to a <code>print_string</code> function</p>
<pre><pre class="playground"><code class="language-rust">struct MyStruct {
    name: String,
}

impl MyStruct {
    fn new(name: &amp;str) -&gt; Self {
        MyStruct {
            name: String::from(name),
        }
    }
}

fn print_string(s: MyStruct) {
    println!(&quot;{}&quot;, s.name);
}

impl Drop for MyStruct {
    fn drop(&amp;mut self) {
        println!(&quot;MyStruct instance with name '{}' dropped&quot;, self.name);
    }
}

fn main() {
    let _s = MyStruct::new(&quot;example&quot;);
    // `s` will be dropped at the end of this scope
    print_string(_s);
    println!(&quot;End of main function&quot;);
}</code></pre></pre>
<p>You should see:</p>
<p>example<br />
MyStruct instance with name 'example' dropped<br />
End of main function</p>
<p>So you can clearly see when the MyStruct _s is dropped and why we can't call two times
<code>print_string</code> function</p>
</div>
</div>
<h2 id="clone"><a class="header" href="#clone">Clone</a></h2>
<p>Remember when the compiler says this:</p>
<ul>
<li>move occurs because <code>s</code> has type <code>String</code>, which does not implement the <code>Copy</code> trait</li>
</ul>
<p>If you look at what the compiler says it also tell us that:
help: consider cloning the value if the performance cost is acceptable
|
7 |     print_string(s.clone());</p>
<pre><pre class="playground"><code class="language-rust">fn print_string(s: String) {
    println!(&quot;{}&quot;, s);
}

fn main() {
    let s = String::from(&quot;hello&quot;);
    print_string(s.clone());
    print_string(s);
}</code></pre></pre>
<p>Here the first <code>print_string</code> take the ownership of a deep copy of the string <code>s</code> let's says <code>s'</code>, and the second <code>print_string</code> take the ownership of <code>s</code></p>
<h2 id="borrow"><a class="header" href="#borrow">Borrow</a></h2>
<p>Compiler friend also tell us:</p>
<ul>
<li>note: consider changing this parameter type in function <code>print_string</code> to borrow instead if owning the value isn't necessary</li>
</ul>
<p>You can also pass ownership of a value to a function temporarily using references. For example:</p>
<pre><pre class="playground"><code class="language-rust">fn print_string(s: &amp;String) {
    println!(&quot;{}&quot;, s);
}

fn main() {
    let s = String::from(&quot;hello&quot;);
    print_string(&amp;s);
}</code></pre></pre>
<p>In this code, a reference to the string is passed to the print_string function instead of the value itself. The function can use the value of the string, but ownership remains with the caller.</p>
<p>If i go back to my code with Drop trait and change the <code>print_function</code> to borrow the ownership:</p>
<pre><pre class="playground"><code class="language-rust">struct MyStruct {
    name: String,
}

impl MyStruct {
    fn new(name: &amp;str) -&gt; Self {
        MyStruct {
            name: String::from(name),
        }
    }
}

fn print_string(s: &amp;MyStruct) {
    println!(&quot;{}&quot;, s.name);
}

impl Drop for MyStruct {
    fn drop(&amp;mut self) {
        println!(&quot;MyStruct instance with name '{}' dropped&quot;, self.name);
    }
}

fn main() {
    let _s = MyStruct::new(&quot;example&quot;);
    // `s` will be dropped at the end of this scope
    print_string(&amp;_s);
    println!(&quot;End of main function&quot;);
}</code></pre></pre>
<p>output:
example<br />
End of main function<br />
MyStruct instance with name 'example' dropped</p>
<p><code>_s</code> var keep the ownership, <code>print_function</code> only borrow the memory and this memory will be drop at the end of the scope of the main function.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="example-of-borrow-checker---ownership-case"><a class="header" href="#example-of-borrow-checker---ownership-case">Example of borrow-checker - ownership case</a></h1>
<h2 id="iterate-hashmap-and-update-value"><a class="header" href="#iterate-hashmap-and-update-value">Iterate HashMap and update value</a></h2>
<p>Iterate over a HashMap and modify the values, but you need to be careful because Rust's borrow checker will prevent you from doing so in certain situations.</p>
<p>One way to modify values in a HashMap while iterating over it is to use the HashMap::entry method to get a mutable reference to the value, and then modify the value using the mutable reference.</p>
<p>Ok let's say i want to iterate through a map, here is a naive solution:</p>
<div id="admonition-bug" class="admonition bug">
<div class="admonition-title">
<p>Bug</p>
<p><a class="admonition-anchor-link" href="dev/rust/borrow-checker.html#admonition-bug"></a></p>
</div>
<div>
<p>This will no work in rust, you can launch this code  here in this  browser and see the error:</p>
<pre><pre class="playground"><code class="language-rust">use std::collections::HashMap;

fn main() {
    let mut my_map = HashMap::new();

    my_map.insert(&quot;foo&quot;, 1);
    my_map.insert(&quot;bar&quot;, 2);

    for (k, v) in my_map {
        my_map[k] = v + 1;
    }

    println!(&quot;{:?}&quot;, my_map);
}</code></pre></pre>
</div>
</div>
<p>As you can see with <code>for (key, value) in my_map</code>  the ownership of <code>my_map</code> is moved due to the implicit call to <code>.into_iter()</code> with the <code>for ... in</code> statement.
Then</p>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<p>Info</p>
<p><a class="admonition-anchor-link" href="dev/rust/borrow-checker.html#admonition-info"></a></p>
</div>
<div>
<p>my_map[k] = v + 1;<br />
^^^^^^ value borrowed here after move</p>
</div>
</div>
when we try to update the map we need to borrow the ownership of the map. But as the ownership to the map gas already been given to`.into_iter()` you're stuck
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="dev/rust/borrow-checker.html#admonition-note"></a></p>
</div>
<div>
<p>You can also see that <code>HashMap&lt;&amp;str, i32&gt;</code>, which does not implement the <code>Copy</code> trait.
Indeed if we could copy the hashmap we could iter throught the first and update the new one.</p>
</div>
</div>
<p>So how can we do our stuff ?</p>
<div id="admonition-success" class="admonition success">
<div class="admonition-title">
<p>Success</p>
<p><a class="admonition-anchor-link" href="dev/rust/borrow-checker.html#admonition-success"></a></p>
</div>
<div>
<p>use std::collections::HashMap;</p>
<pre><pre class="playground"><code class="language-rust">use std::collections::HashMap;

fn main() {
    let mut my_map = HashMap::new();

    my_map.insert(&quot;foo&quot;, 1);
    my_map.insert(&quot;bar&quot;, 2);

    for (_k, v) in my_map.iter_mut() {
        *v += 1;
    }

    println!(&quot;{:?}&quot;, my_map);
}</code></pre></pre>
<p>In this example, we first create a HashMap and insert two key-value pairs into it. Then, we use the iter_mut method to iterate over the map's values, getting mutable references to each value. We can then modify each value using the mutable reference.</p>
<p>Note that we use the * operator to dereference the mutable reference and modify the value it points to.</p>
</div>
</div>
<p>We can create a new HashMap with the modified key-value pairs and replace the old HashMap with the new one.</p>
<p>Here's an example:</p>
<pre><pre class="playground"><code class="language-rust">use std::collections::HashMap;

fn main() {
    let mut my_map = HashMap::new();

    my_map.insert(&quot;foo&quot;, 1);
    my_map.insert(&quot;bar&quot;, 2);

    let new_map: HashMap&lt;_, _&gt; = my_map
        .into_iter()
        .map(|(key, mut value)| {
            if key.starts_with(&quot;b&quot;) {
                value += 1;
            }
            (key, value)
        })
        .collect();

    println!(&quot;{:?}&quot;, new_map);
}</code></pre></pre>
<p>In this example, we use into_iter to consume the original HashMap and create a new one with modified key-value pairs. The closure passed to map takes ownership of each key-value pair, and modifies the value if the key starts with the letter &quot;b&quot;. Finally, collect is called to create a new HashMap from the modified key-value pairs.</p>
<details id="admonition-booooo--way-to-slow-with-large-map-" class="admonition note">
<summary class="admonition-title">
<p>Booooo ! Way to slow with large Map! üòàüòà</p>
<p><a class="admonition-anchor-link" href="dev/rust/borrow-checker.html#admonition-booooo--way-to-slow-with-large-map-"></a></p>
</summary>
<div>
<p>Note that this approach creates a new HashMap, so if the original HashMap is large, it may not be the most efficient solution. If efficiency is a concern, you can use a mutable HashMap and modify the values in place using HashMap::entry.</p>
</div>
</details>
<p>You can modify the HashMap in place using the HashMap::retain method. The retain method takes a closure that operates on the key-value pairs of the HashMap and removes any pairs for which the closure returns false.</p>
<pre><pre class="playground"><code class="language-rust">use std::collections::HashMap;

fn main() {
    let mut my_map = HashMap::new();

    my_map.insert(&quot;foo&quot;, 1);
    my_map.insert(&quot;bar&quot;, 2);

    my_map.retain(|key, value| {
        *value += 1;
        key.starts_with(&quot;b&quot;)
    });

    println!(&quot;{:?}&quot;, my_map);
}</code></pre></pre>
<p>In this example, we use the retain method to modify the HashMap in place. The closure passed to retain takes mutable references to the key and the value, and we can modify the value using the mutable reference.</p>
<p>The closure also returns a bool indicating whether the key-value pair should be kept or removed. In this example, we only keep the pairs whose keys start with the letter &quot;b&quot;. The pairs whose keys start with &quot;f&quot; are removed from the HashMap.</p>
<p>Note that this approach works because we're modifying the HashMap in place, but we're not modifying the keys themselves. If you need to modify the keys as well, you'll need the solution with two loops.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-async-introduction"><a class="header" href="#rust-async-introduction">Rust Async introduction</a></h1>
<h2 id="tokio"><a class="header" href="#tokio">Tokio</a></h2>
<p><img src="https://tokio.rs/" alt="Tokio" /> is a runtime for writing reliable asynchronous applications with Rust. It provides async I/O, networking, scheduling, timers, and more.</p>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<p>Example with two function a and b. In the first one, in a non-async function main, we create a tokio runtime. <code>let rt = Runtime::new().unwrap();</code> This object will handle all the async/concurrency for us.</p>
<details id="admonition-but--what-the-heck-is-a-tokio-runtime--" class="admonition note">
<summary class="admonition-title">
<p>But ! What the heck is a tokio runtime ? üòµ</p>
<p><a class="admonition-anchor-link" href="dev/rust/async-intro.html#admonition-but--what-the-heck-is-a-tokio-runtime--"></a></p>
</summary>
<div>
<p>Tokio is an asynchronous runtime for Rust, built on top of the futures and async/await primitives.
It provides a set of tools for building high-performance, concurrent, and scalable network applications.</p>
<p>The key idea behind Tokio is that it provides an event loop, which is responsible for driving I/O operations and executing tasks that are scheduled by the program.
When an I/O operation is initiated, Tokio adds it to the event loop, and then continues executing other tasks.
When the I/O operation completes, Tokio wakes up the task that initiated it, allowing it to continue its execution.</p>
<p>Tokio also provides a number of utilities and abstractions for building asynchronous applications, such as futures, streams, and channels. 
These abstractions make it easy to express complex asynchronous workflows in a clear and concise way, while still maintaining high performance.</p>
</div>
</details>
<p>OK then next ? what can i do with this instanciated struct runtime <code>rt</code> ?</p>
<p>let's take a look to the function block_on. With the signature: <code>pub fn block_on&lt;F: Future&gt;(&amp;self, future: F) -&gt; F::Output</code>
Which says to us:
Runs a future to completion on the Tokio runtime. This is the runtime‚Äôs entry point.</p>
<p>This runs the given future on the current thread, blocking until it is complete, and yielding its resolved result. Any tasks or timers which the future spawns internally will be executed on the runtime.</p>
<pre><pre class="playground"><code class="language-rust">use futures::stream::{self, StreamExt};
use tokio::task;
use tokio::runtime::Runtime;

async fn a() {
    println!(&quot;Starting a&quot;);
    // ... do some asynchronous work ...
    println!(&quot;Finished a&quot;);
}

async fn b() {
    println!(&quot;Starting b&quot;);
    // ... do some asynchronous work ...
    println!(&quot;Finished b&quot;);
}


 fn main() {

    let rt = Runtime::new().unwrap();
    rt.block_on(async move {
        // ... we will do something here...
    });
}
</code></pre></pre>
<p>Then how to implement something inside the <code>block_on</code> ?</p>
<p>we will use <code>async move</code> which is a combination of two things:</p>
<ul>
<li><code>async</code> indicates that the function returns a future. This means that the function will not block when it is called, but instead it will return a future immediately that can be executed later on.</li>
<li><code>move</code> indicates that the future should take ownership of all variables captured from the enclosing scope. This is necessary because the future may be executed on a different thread, so it needs to own its own data.</li>
</ul>
<p>In the example, rt.block_on() is used to run the future returned by the async move closure that contains the call to stream::iter(). The async move closure is necessary because it captures the tasks variable from the enclosing scope, which needs to be owned by the future.</p>
<pre><pre class="playground"><code class="language-rust">use futures::stream::{self, StreamExt};
use tokio::task;
use tokio::runtime::Runtime;

async fn a() {
    println!(&quot;Starting a&quot;);
    // ... do some asynchronous work ...
    println!(&quot;Finished a&quot;);
}

async fn b() {
    println!(&quot;Starting b&quot;);
    // ... do some asynchronous work ...
    println!(&quot;Finished b&quot;);
}


 fn main() {

    let rt = Runtime::new().unwrap();
    rt.block_on(async move {
        let tasks = vec![task::spawn(a()), task::spawn(b())];
        stream::iter(tasks)
            .buffer_unordered(2) // execute up to 2 tasks concurrently
            .collect::&lt;Vec&lt;_&gt;&gt;()
            .await;
    });
}
</code></pre></pre>
<p>OK there is more to tell:</p>
<ul>
<li><code>let tasks = vec![task::spawn(a()), task::spawn(b())];, task::spawn()</code> creates a 
JoinHandle for each of the functions <code>a()</code> and <code>b()</code>, which represents an asynchronous task that can be executed 
in a Tokio runtime.</li>
<li>JoinHandle is a future that runs the async function in the background and produces a result when it completes.
It is a way to start a new task and obtain a handle to the result of that task.</li>
<li>By collecting the JoinHandles in a vector, we can then use them to create a stream of tasks that can be executed
concurrently using buffer_unordered() method from futures::stream.</li>
</ul>
<h2 id="attribute"><a class="header" href="#attribute">Attribute</a></h2>
<p>Using <code>#[tokio::main]</code> attribute:</p>
<p>The #[tokio::main] attribute is a shorthand for creating a Tokio runtime and running the async 
main function using that runtime.
It essentially wraps your entire main function in a <code>tokio::runtime::Runtime::new().unwrap().block_on(async { ... }) block</code>,
so you don't have to create the runtime manually.</p>
<pre><pre class="playground"><code class="language-rust">use futures::stream::{self, StreamExt};
use tokio::task;

async fn a() {
    println!(&quot;Starting a&quot;);
    // ... do some asynchronous work ...
    println!(&quot;Finished a&quot;);
}

async fn b() {
    println!(&quot;Starting b&quot;);
    // ... do some asynchronous work ...
    println!(&quot;Finished b&quot;);
}

#[tokio::main]
async fn main() {
    let tasks = vec![task::spawn(a()), task::spawn(b())];
    stream::iter(tasks)
        .buffer_unordered(2) // execute up to 2 tasks concurrently
        .collect::&lt;Vec&lt;_&gt;&gt;()
        .await;
}</code></pre></pre>
<h2 id="how-many-task-are-lauch-concurrently-"><a class="header" href="#how-many-task-are-lauch-concurrently-">How many task are lauch concurrently ?</a></h2>
<p><code>.buffer_unordered(n)</code> tell to the runtime how many task (i.e futures) you want to execute.</p>
<p>3 tasks, but 2 executed concurrently:</p>
<pre><pre class="playground"><code class="language-rust">use futures::stream::{self, StreamExt};
use tokio::task;

async fn a() {
    println!(&quot;Starting a&quot;);
    // ... do some asynchronous work ...
    println!(&quot;Finished a&quot;);
}

async fn b() {
    println!(&quot;Starting b&quot;);
    // ... do some asynchronous work ...
    println!(&quot;Finished b&quot;);
}

async fn c() {
    println!(&quot;Starting c&quot;);
    // ... do some asynchronous work ...
    println!(&quot;Finished c&quot;);
}

#[tokio::main]
async fn main() {
    let tasks = vec![task::spawn(a()), task::spawn(b()), task::spawn(c())];
    stream::iter(tasks)
        .buffer_unordered(2) // execute up to 2 tasks concurrently
        .collect::&lt;Vec&lt;_&gt;&gt;()
        .await;
}</code></pre></pre>
<p>In this example, a and b will be executed concurrently,
while c will be executed only after a or b completes.</p>
<div id="admonition-conclusion" class="admonition note">
<div class="admonition-title">
<p>Conclusion</p>
<p><a class="admonition-anchor-link" href="dev/rust/async-intro.html#admonition-conclusion"></a></p>
</div>
<div>
<p>Tokio runtime is designed to manage the execution of asynchronous tasks,
which are represented as futures. When a future is spawned on the runtime,
the runtime manages its execution and schedules it to run on one of the available threads.
The runtime uses a thread pool to efficiently manage the scheduling of tasks across multiple threads,
taking into account the number of available CPU cores on the machine.
This allows the runtime to effectively utilize the available resources and maximize performance.</p>
<p>TL;DR:
Tokio runtime works with tasks/futures and under the hood orchestrate theses futures on threads accordingly
with the number of cpu of the machine.</p>
<p>You can change the number of threads OFC : </p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use tokio::runtime::Builder;

...

let runtime = Builder::new().num_threads($valueHere).build().unwrap();
<span class="boring">}</span></code></pre></pre>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kubernetes"><a class="header" href="#kubernetes">Kubernetes</a></h1>
<p>Kubernetes, also known as <span style="color: hotpink">K8s</span>, is an open-source system for automating deployment, scaling, and management of containerized applications.</p>
<ul>
<li><a href="ops/kubernetes/architecture_overview.html">Architecture overview</a></li>
<li><a href="ops/kubernetes/kind.html">Create a local cluster with kind</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architecture-overview"><a class="header" href="#architecture-overview">Architecture Overview</a></h1>
<details id="admonition-warning" class="admonition warning">
<summary class="admonition-title">
<p>Warning</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/architecture_overview.html#admonition-warning"></a></p>
</summary>
<div>
<p>this documentation is a substrate / personal synthesis with less information than the official documentation of kuerbenetes which can be found <a href="https://kubernetes.io/docs/concepts/overview/components/">here</a></p>
</div>
</details>
<p><img src="ops/kubernetes/img/components-of-kubernetes.svg" alt="Components" /></p>
<details id="admonition-kubernetes-cluser" class="admonition info">
<summary class="admonition-title">
<p>Kubernetes Cluser</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/architecture_overview.html#admonition-kubernetes-cluser"></a></p>
</summary>
<div>
<p>A Kubernetes cluster is a set of worker machines, called nodes, that run containerized applications.</p>
<p>This cluster consist in two nodes family, the workers and the control-plane.</p>
<ul>
<li>The control plane handle and manage the worker nodes and the Pods in the cluster.</li>
<li>The worker node(s) is the machine(s) where your applications workload will be deployed.</li>
</ul>
<p>Warning : the image here does not show that the control plane is also running in nodes !</p>
</div>
</details>
<details id="admonition-pods-workload-" class="admonition bug">
<summary class="admonition-title">
<p>Pods, Workload ?</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/architecture_overview.html#admonition-pods-workload-"></a></p>
</summary>
<div>
<p>About kubernetes wording:</p>
<ul>
<li>Workload: It's an app running on Kubernetes. It could be a single component or several that work together.</li>
<li>Pods: Smallest deployable units of computing that you can create and manage in Kubernetes. It's a group of one or more containers.</li>
</ul>
</div>
</details>
<h2 id="control-plane"><a class="header" href="#control-plane">Control Plane</a></h2>
<p>The control plane's components make global decisions about the cluster. Control plane components can be run on any machine in the cluster. However, for simplicity, set up scripts typically start all control plane components on the same machine, and do not run user containers on this machine.</p>
<details id="admonition-kube-apiserver" class="admonition note">
<summary class="admonition-title">
<p>kube-apiserver</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/architecture_overview.html#admonition-kube-apiserver"></a></p>
</summary>
<div>
<p>Expose the kubernetes API, front end for control plane. Kube-apiserver is designed to scale horizontally‚Äîthat is, it scales by deploying more instances.
Kube-api-server run in a pod, for each vm in control plane. You can find these pods with </p>
<p><code>kubectl get po -o wide -n kube-system | grep apiserver</code></p>
</div>
</details>
<details id="admonition-etcd" class="admonition note">
<summary class="admonition-title">
<p>etcd</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/architecture_overview.html#admonition-etcd"></a></p>
</summary>
<div>
<p>Consistent and highly-available key value store used as Kubernetes' backing store for all cluster data. This store run in multiples pods in control plane.
You can find these pods with<br />
<code>kubectl get po -o wide -n kube-system | grep etcd</code></p>
</div>
</details>
<details id="admonition-kube-scheduler" class="admonition note">
<summary class="admonition-title">
<p>kube-scheduler</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/architecture_overview.html#admonition-kube-scheduler"></a></p>
</summary>
<div>
<p>Control plane component that watches for newly created Pods with no assigned node, and selects a node for them to run on.
Factors taken into account for scheduling decisions include: individual and collective resource requirements, hardware/software/policy constraints, affinity and anti-affinity specifications, data locality, inter-workload interference, and deadlines.
You can find these pods with<br />
<code>kubectl get po -o wide -n kube-system | grep scheduler</code></p>
</div>
</details>
<details id="admonition-kube-controller-manager" class="admonition note">
<summary class="admonition-title">
<p>kube-controller-manager</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/architecture_overview.html#admonition-kube-controller-manager"></a></p>
</summary>
<div>
<p>Control plane component that runs <span style="color: hotpink">controller</span> processes. I will explain <a href="https://iximiuz.com/en/posts/kubernetes-operator-pattern/">operator</a> and <a href="https://kubernetes.io/docs/concepts/architecture/controller/">controller</a> later.
Some types of these controllers are:</p>
<ul>
<li>Node controller: Responsible for noticing and responding when nodes go down.</li>
<li>Job controller: Watches for Job objects that represent one-off tasks, then creates Pods to run those tasks to completion.</li>
<li>EndpointSlice controller: Populates EndpointSlice objects (to provide a link between Services and Pods).</li>
<li>ServiceAccount controller: Create default ServiceAccounts for new namespaces.</li>
</ul>
<p><code>kubectl get po -o wide -n kube-system | grep controller-manager</code></p>
</div>
</details>
<details id="admonition-cloud-controller-manager" class="admonition note">
<summary class="admonition-title">
<p>cloud-controller-manager</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/architecture_overview.html#admonition-cloud-controller-manager"></a></p>
</summary>
<div>
<p>The cloud controller manager lets you link your cluster into your cloud provider's API, and separates out the components that interact with that cloud platform from components that only interact with your cluster.</p>
</div>
</details>
<h2 id="nodes"><a class="header" href="#nodes">Nodes</a></h2>
<p>Node components run on every node, maintaining running pods and providing the Kubernetes runtime environment.</p>
<details id="admonition-kubelet" class="admonition note">
<summary class="admonition-title">
<p>kubelet</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/architecture_overview.html#admonition-kubelet"></a></p>
</summary>
<div>
<p>Agent that runs on each node in the cluster. It makes sure that containers are running in a Pod.</p>
<p>Kubelet run as process on each node in the cluster, rather than running inside a pod like etcd, apiserver.</p>
</div>
</details>
<details id="admonition-kube-proxy" class="admonition note">
<summary class="admonition-title">
<p>kube-proxy</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/architecture_overview.html#admonition-kube-proxy"></a></p>
</summary>
<div>
<p>kube-proxy is a network proxy that runs on each node in your cluster, implementing part of the Kubernetes <a href="ops/kubernetes/services.html">Service</a> concept.</p>
<p>kube-proxy maintains network rules on nodes. These network rules allow network communication to your Pods from network sessions inside or outside of your cluster.</p>
<p>kube-proxy uses the operating system packet filtering layer if there is one and it's available. Otherwise, kube-proxy forwards the traffic itself.</p>
<p><code>kubectl get po -o wide -n kube-system | grep kube-proxy</code></p>
</div>
</details>
<details id="admonition-container-runtime" class="admonition note">
<summary class="admonition-title">
<p>Container runtime</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/architecture_overview.html#admonition-container-runtime"></a></p>
</summary>
<div>
<p>The container runtime is the software that is responsible for running containers.</p>
<p>Kubernetes supports container runtimes such as containerd, CRI-O, and any other implementation of the Kubernetes <a href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-node/container-runtime-interface.md">CRI</a> (Container Runtime Interface).</p>
</div>
</details>
<h2 id="addons"><a class="header" href="#addons">Addons</a></h2>
<p>Addons use Kubernetes resources (DaemonSet, Deployment, etc) to implement cluster features. Because these are providing cluster-level features, namespaced resources for addons belong within the kube-system namespace. List of <a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/">addons</a></p>
<details id="admonition-dns" class="admonition note">
<summary class="admonition-title">
<p>DNS</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/architecture_overview.html#admonition-dns"></a></p>
</summary>
<div>
<p>While the other addons are not strictly required, all Kubernetes clusters should have <a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">cluster DNS</a>, as many examples rely on it.</p>
<p>Cluster DNS is a DNS server, in addition to the other DNS server(s) in your environment, which serves DNS records for Kubernetes services.</p>
</div>
</details>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kind"><a class="header" href="#kind">Kind</a></h1>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<p>Note</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/kind.html#admonition-note"></a></p>
</div>
<div>
<p><a href="https://kind.sigs.k8s.io/">kind</a> is a tool for running local Kubernetes clusters using Docker container ‚Äúnodes‚Äù.
kind was primarily designed for testing Kubernetes itself, but may be used for local development or CI.</p>
</div>
</div>
<details id="admonition-install" class="admonition warning">
<summary class="admonition-title">
<p>install</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/kind.html#admonition-install"></a></p>
</summary>
<div>
<p>If you have go (1.17+) and docker installed  <code>go install sigs.k8s.io/kind@v0.18.0</code></p>
<p>Other way: <a href="https://kind.sigs.k8s.io/docs/user/quick-start#installation">here</a></p>
</div>
</details>
<details id="admonition-config-file" class="admonition example">
<summary class="admonition-title">
<p>config file</p>
<p><a class="admonition-anchor-link" href="ops/kubernetes/kind.html#admonition-config-file"></a></p>
</summary>
<div>
<pre><code class="language-yaml">kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
# One control plane node and three &quot;workers&quot;.
#
# While these will not add more real compute capacity and
# have limited isolation, this can be useful for testing
# rolling updates etc.
#
# The API-server and other control plane components will be
# on the control-plane node.
#
# You probably don't need this unless you are testing Kubernetes itself.
nodes:
  - role: control-plane
  - role: control-plane
  - role: worker
  - role: worker
  - role: worker
</code></pre>
</div>
</details>
<p>How to <span style="color: hotpink">create</span> a cluster from a config file:</p>
<pre><code>kind create cluster --name local-cluster --config cluster-config.yaml
</code></pre>
<p>How to <span style="color: hotpink">delete</span> a cluster:</p>
<pre><code>kind delete clusters local-cluster
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="databases"><a class="header" href="#databases">Databases</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql"><a class="header" href="#sql">SQL</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="postgres"><a class="header" href="#postgres">Postgres</a></h1>
<pre><code class="language-bash">docker run -d --name my-postgres -e POSTGRES_PASSWORD=postgres -e POSTGRES_USER=postgres -e POSTGRES_DB=goods -p 5432:5432 postgres:15.2

docker exec -it postgresql psql -d goods -U postgres
</code></pre>
<pre><code class="language-sql">CREATE TABLE goods(
    id BIGSERIAL NOT NULL PRIMARY KEY ,
    name VARCHAR(255) NOT NULL,
    description TEXT NULL,
    price INT NOT NULL
);

INSERT INTO goods (name, description, price)
VALUES ('Apple', 'Red fruit', 100),
       ('Orange', 'Orange fruit', 150),
       ('Banana', 'Yellow fruit', 200),
       ('Pineapple', 'Yellow fruit', 250),
       ('Melon', 'Green fruit', 300);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="nosql"><a class="header" href="#nosql">NoSQL</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dgraph"><a class="header" href="#dgraph">dgraph</a></h1>
<p><a href="https://github.com/dgraph-io/dgraph">Dgraph</a></p>
<p>graph database with graphql as query lang</p>
<pre><code class="language-yaml"># This Docker Compose file can be used to quickly bootup Dgraph Zero
# and Alpha in different Docker containers.

# It mounts /tmp/data on the host machine to /dgraph within the
# container. You will need to change /tmp/data to a more appropriate location.
# Run `docker-compose up` to start Dgraph.

version: &quot;3.2&quot;
services:
  zero:
    image: dgraph/dgraph:latest
    volumes:
      - /tmp/data:/dgraph
    ports:
      - 5080:5080
      - 6080:6080
    restart: on-failure
    command: dgraph zero --my=zero:5080
  alpha:
    image: dgraph/dgraph:latest
    volumes:
      - /tmp/data:/dgraph
    ports:
      - 8080:8080
      - 9080:9080
    restart: on-failure
    command: dgraph alpha --my=alpha:7080 --zero=zero:5080
  ratel:
    image: dgraph/ratel:latest
    ports:
      - 8000:8000
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="testing"><a class="header" href="#testing">Testing</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vegeta"><a class="header" href="#vegeta">Vegeta</a></h1>
<pre><code class="language-bash">vegeta attack -targets conf.txt -name=5000qps -rate=5000 -duration=1s &gt; result.js.bin
</code></pre>
<p>Simple GET request</p>
<pre><code>GET http://localhost:8080/goods
</code></pre>
<p>POST with body Example of conf.txt</p>
<pre><code>POST http://localhost:8082/api/graphql
Authorization: Bearer ..
content-type: application/json
@body.json
</code></pre>
<p>Example of body.json</p>
<pre><code class="language-json">{
  &quot;query&quot;: &quot;query{\n  rmfs(){\n    edges{\n      node{\n        id\n        name\n      }\n    }\n  }\n}&quot;
}
</code></pre>
<h2 id="ramp-up"><a class="header" href="#ramp-up">ramp up</a></h2>
<pre><code class="language-bash">echo &quot;GET &lt;http://:6060&gt;&quot; | ./vegeta attack -timeout=6s -duration=20s -plan=&quot;100@2s 200@4s 400@6s 500@8s 600@10s&quot; | tee result.bin | ./vegeta report
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gpg-pgp--sops"><a class="header" href="#gpg-pgp--sops">GPG-PGP &amp; sops</a></h1>
<h1 id="pgp"><a class="header" href="#pgp">PGP</a></h1>
<div id="admonition-gpg-pgp-differences" class="admonition tip">
<div class="admonition-title">
<p>gpg pgp differences</p>
<p><a class="admonition-anchor-link" href="ops/gpg-pgp.html#admonition-gpg-pgp-differences"></a></p>
</div>
<div>
<ul>
<li>In short, GPG is a CLI tool that implements PGP</li>
<li>PGP (Pretty Good Privacy) is an encryption program that provides cryptographic privacy and authentication for data communication. It can be used for signing, encrypting, and decrypting texts, e-mails, files...</li>
<li>GPG, on the other hand, stands for GnuPG, which is a free implementation (a command line tool) of the OpenPGP standard, RFC4880. 
<img src="ops/img/pgp.drawio.svg" alt="pgp" /></li>
</ul>
</div>
</div>
<h2 id="gpg-cli"><a class="header" href="#gpg-cli">GPG cli</a></h2>
<p>Create a public and private key (and keyring + trustdb if not already present) in the current directory under .gnupg folder</p>
<pre><code>gpg --gen-key --homedir .gnupg
</code></pre>
<p>You will be asked for somes info and a passphrase</p>
<details id="admonition-output" class="admonition example">
<summary class="admonition-title">
<p>output</p>
<p><a class="admonition-anchor-link" href="ops/gpg-pgp.html#admonition-output"></a></p>
</summary>
<div>
<p>gpg (GnuPG) 2.2.27; Copyright (C) 2021 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.</p>
<p>gpg: directory '/home/user/rust/thoughts/.gnupg' created
gpg: keybox '/home/user/rust/thoughts/.gnupg/pubring.kbx' created
Note: Use &quot;gpg --full-generate-key&quot; for a full featured key generation dialog.</p>
<p>GnuPG needs to construct a user ID to identify your key.</p>
<p>Real name: jonsnow
Email address: jonsnow@stark.com
You selected this USER-ID:
&quot;jonsnow <a href="mailto:ops/jonsnow@stark.com">jonsnow@stark.com</a>&quot;</p>
<p>Change (N)ame, (E)mail, or (O)kay/(Q)uit? o<br />
We need to generate a lot of random bytes. It is a good idea to perform<br />
some other action (type on the keyboard, move the mouse, utilize the<br />
disks) during the prime generation; this gives the random number<br />
generator a better chance to gain enough entropy.<br />
gpg: /home/user/rust/thoughts/.gnupg/trustdb.gpg: trustdb created<br />
gpg: key 44F3DCD5924B36B0 marked as ultimately trusted<br />
gpg: directory '/home/user/rust/thoughts/.gnupg/openpgp-revocs.d' created<br />
gpg: revocation certificate stored as '/home/user/rust/thoughts/.gnupg/openpgp-revocs.d/  484DFB2278EABBF9CCE040F744F3DCD5924B36B0.rev'<br />
public and secret key created and signed.</p>
<p>pub   rsa3072 2023-04-18 [SC] [expires: 2025-04-17]
484DFB2278EABBF9CCE040F744F3DCD5924B36B0
uid                      jonsnow <a href="mailto:ops/jonsnow@stark.com">jonsnow@stark.com</a>
sub   rsa3072 2023-04-18 [E] [expires: 2025-04-17]</p>
</div>
</details>
<p>Export private key ring</p>
<pre><code>gpg --no-default-keyring --homedir .gnupg/ --export-secret-keys &gt; ./.gnupg/secret_keys_ring.gpg
</code></pre>
<p>Export public key ring</p>
<pre><code>gpg --no-default-keyring --homedir .gnupg/ --export &gt; ./.gnupg/public_key_ring.gpg
</code></pre>
<p>list secret-keys id in keyring</p>
<pre><code>gpg --no-default-keyring --homedir .gnupg/ --list-secret-keys --keyid-format LONG
</code></pre>
<p>output</p>
<pre><code>/home/user/go/src/github.com/user/pgp-test/./.gnupg/pubring.kbx
----------------------------------------------------------------------
sec   rsa3072/840F06145BCC384E 2023-04-18 [SC] [expires: 2025-04-17]
      45E3IDIDIDIDC5D22144DF06145BCC384E.....
uid                 [ultimate] jonsnow &lt;jonsnow@stark.com&gt;
ssb   rsa3072/0A5EC7E2D68FF709 2023-04-18 [E] [expires: 2025-04-17]
</code></pre>
<p>Export as armored a specific secret key</p>
<pre><code>gpg --no-default-keyring --homedir .gnupg/ --armor --export-secret-keys 45E3IDIDIDIDC5D22144DF06145BCC384E...
</code></pre>
<p>Export as armored a specific public key</p>
<pre><code>gpg --no-default-keyring --homedir .gnupg/ --armor --export 45E3IDIDIDIDC5D22144DF06145BCC384E...
</code></pre>
<p>content of .gnupg folder</p>
<pre><code>drwx------     - user 18 avril 11:26 openpgp-revocs.d
drwx------     - user 18 avril 11:26 private-keys-v1.d
.rw-rw-r--  1,7k user 18 avril 11:33 public_key_ring.gpg
.rw-rw-r--  2,0k user 18 avril 11:26 pubring.kbx
.rw-------    32 user 18 avril 11:26 pubring.kbx~
.rw-rw-r--  3,8k user 18 avril 11:32 secret_keys_ring.gpg
.rw-------  1,3k user 18 avril 11:26 trustdb.gpg

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux"><a class="header" href="#linux">Linux</a></h1>
<p>Remove old kernel</p>
<pre><code>#!/bin/bash
# Run this script without any param for a dry run
# Run the script with root and with exec param for removing old kernels after checking
# the list printed in the dry run

uname -a
IN_USE=$(uname -a | awk '{ print $3 }')
echo &quot;Your in use kernel is $IN_USE&quot;

OLD_KERNELS=$(
    dpkg --list |
        grep -v &quot;$IN_USE&quot; |
        grep -Ei 'linux-image|linux-headers|linux-modules' |
        awk '{ print $2 }'
)
echo &quot;Old Kernels to be removed:&quot;
echo &quot;$OLD_KERNELS&quot;

if [ &quot;$1&quot; == &quot;exec&quot; ]; then
    for PACKAGE in $OLD_KERNELS; do
        yes | apt purge &quot;$PACKAGE&quot;
    done
else
    echo &quot;If all looks good, run it again like this: sudo remove_old_kernels.sh exec&quot;
fi

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="git"><a class="header" href="#git">Git</a></h1>
<h2 id="gitlab"><a class="header" href="#gitlab">Gitlab</a></h2>
<p>First you need to create a personal access token
git config --global credential.helper store
git pull</p>
<p>it will ask you your username and password (use your pat). Then there is no need to enter user/password</p>
<h2 id="pre-commit"><a class="header" href="#pre-commit">Pre-commit</a></h2>
<p><a href="https://pre-commit.com">pre-commit</a> is a python tool used to check commit before push</p>
<pre><code class="language-bash">#!/bin/bash

pip3 install pre-commit==3.0.4

pre-commit install
</code></pre>
<div id="admonition-configuration" class="admonition example">
<div class="admonition-title">
<p>configuration</p>
<p><a class="admonition-anchor-link" href="general/git.html#admonition-configuration"></a></p>
</div>
<div>
<p>Here is a example of configuration for pre commit, as you can see it use default installed hook and some hook for externals repo</p>
<p>example: commitizen used for git commit angular convention</p>
<p>the file name should be <code>.pre-commit-config.yaml</code></p>
<pre><code class="language-yaml"># See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks
default_install_hook_types:
  - pre-commit
  - commit-msg
repos:
  - repo: https://github.com/commitizen-tools/commitizen
    rev: v2.42.1
    hooks:
      - id: commitizen
        stages: [commit-msg]
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
      - id: check-json
        stages: [commit]
      - id: check-merge-conflict
        stages: [commit]
      - id: trailing-whitespace
        stages: [commit]
      - id: end-of-file-fixer
        stages: [commit]
      - id: check-yaml
        stages: [commit]
      - id: check-added-large-files
        stages: [commit]
      - id: check-executables-have-shebangs
        stages: [commit]
      - id: detect-aws-credentials
        stages: [commit]
      - id: detect-private-key
        stages: [commit]
  - repo: https://github.com/pre-commit/mirrors-prettier
    # Use the sha or branch you want to point at
    rev: v3.0.0-alpha.6
    hooks:
      - id: prettier
        stages: [commit]
  - repo: https://github.com/shellcheck-py/shellcheck-py
    rev: v0.9.0.2
    hooks:
      - id: shellcheck
        stages: [commit]
  - repo: https://github.com/zricethezav/gitleaks
    rev: v8.16.0
    hooks:
      - id: gitleaks
        stages: [commit]
</code></pre>
</div>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="contributors"><a class="header" href="#contributors">Contributors</a></h1>
<p><a href="https://remifabas.github.io/">R√©mi Fabas</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
